{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Deny",
      "Action": [
        "ec2:RunInstances"
      ],
      "Resource": [
        "arn:aws:ec2:*::image/*"
      ],
      "Condition": {
        "StringNotEquals": {
          "ec2:ResourceTag/platform_image_whitelist": "yes"
        },
        "ForAllValues:StringLike": {
          "aws:TagKeys": [
            "*"
          ]
        }
      }
    },
    {
      "Action": [
        "config:Put*",
        "config:UntagResource"
      ],
      "Effect": "Deny",
      "Resource": "*",
      "Condition": {
        "ArnNotLike": {
          "aws:PrincipalARN": [
            "arn:aws:iam::*:role/platform*",
            "arn:aws:iam::*:role/aws-reserved/sso.amazonaws.com/*platform*",
            "arn:aws:iam::*:role/*AWSControlTower*",
            "arn:aws:iam::master_account_id:role/aws-service-role/stacksets.cloudformation.amazonaws.com/AWSServiceRoleForCloudFormationStackSetsOrgAdmin*",
            "arn:aws:iam::*:role/stacksets-exec*",
            "arn:aws:iam::*:role/aws-controltower*"
          ]
        },
        "ForAllValues:StringEqualsIgnoreCase": {
          "aws:TagKeys": [
            "platform_donotdelete"
          ]
        }
      }
    },
    {
      "Action": [
        "logs:*",
        "events:*"
      ],
      "Effect": "Deny",
      "Resource": [
        "arn:aws:logs:*:*:log-group:platform*:*",
        "arn:aws:events:*:*:rule/platform*"
      ],
      "Condition": {
        "ArnNotLike": {
          "aws:PrincipalARN": [
            "arn:aws:iam::*:role/platform*",
            "arn:aws:iam::*:role/*Wiz*",
            "arn:aws:iam::*:role/aws-reserved/sso.amazonaws.com/*platform*",
            "arn:aws:iam::*:role/*AWSControlTower*",
            "arn:aws:iam::master_account_id:role/aws-service-role/stacksets.cloudformation.amazonaws.com/AWSServiceRoleForCloudFormationStackSetsOrgAdmin*",
            "arn:aws:iam::*:role/stacksets-exec*",
            "arn:aws:iam::*:role/aws-controltower*"
          ]
        }
      }
    },
    {
      "Effect": "Deny",
      "Action": [
        "ec2:RunInstances"
      ],
      "Condition": {
        "Bool": {
          "ec2:AssociatePublicIpAddress": "true"
        }
      },
      "Resource": "arn:aws:ec2:*:*:network-interface/*"
    },
    {
      "NotAction": [
        "lambda:GetAccountSettings",
        "lambda:GetFunctionConfiguration",
        "lambda:GetFunctionEventInvokeConfig",
        "lambda:GetLayerVersionPolicy",
        "lambda:GetPolicy",
        "lambda:List*"
      ],
      "Effect": "Deny",
      "Resource": "arn:aws:lambda:*:*:function:platform*",
      "Condition": {
        "ArnNotLike": {
          "aws:PrincipalARN": [
            "arn:aws:iam::*:role/platform*",
            "arn:aws:iam::*:role/*Wiz*",
            "arn:aws:iam::*:role/aws-reserved/sso.amazonaws.com/*platform*",
            "arn:aws:iam::*:role/*AWSControlTower*",
            "arn:aws:iam::master_account_id:role/aws-service-role/stacksets.cloudformation.amazonaws.com/AWSServiceRoleForCloudFormationStackSetsOrgAdmin*",
            "arn:aws:iam::*:role/stacksets-exec*",
            "arn:aws:iam::*:role/aws-controltower*"
          ]
        }
      }
    },
    {
      "Action": [
        "ec2:ModifyAddressAttribute",
        "ec2:ModifyCapacityReservation",
        "ec2:ModifyClientVpnEndpoint",
        "ec2:ModifyIdFormat",
        "ec2:ModifyIdentityIdFormat",
        "ec2:ModifyManagedPrefixList",
        "ec2:ModifyReservedInstances",
        "ec2:ModifySubnetAttribute",
        "ec2:ModifyTransitGateway*",
        "ec2:ModifyVpc*",
        "ec2:ModifyVpn*",
        "ec2:DeleteFlowLogs",
        "ec2:CreateVpc",
        "ec2:CreateSubnet",
        "ec2:DeleteVpc",
        "ec2:DeleteSubnet",
        "ec2:CreateInternetGateway",
        "ec2:DeleteInternetGateway",
        "ec2:CreateRoute",
        "ec2:DeleteRoute",
        "ec2:ReplaceRoute*",
        "ec2:CreateDefault*",
        "ec2:CreateRouteTable",
        "ec2:AssociateSubnetCidrBlock",
        "ec2:AssociateVpcCidrBlock",
        "ec2:DisassociateSubnetCidrBlock",
        "ec2:DisassociateVpcCidrBlock",
        "ec2:CreateTransitGateway",
        "ec2:DeleteTransitGateway",
        "config:Delete*",
        "grafana:AssociateLicense",
        "grafana:DisassociateLicense"
      ],
      "Effect": "Deny",
      "Resource": "*",
      "Condition": {
        "ArnNotLike": {
          "aws:PrincipalARN": [
            "arn:aws:iam::*:role/platform*",
            "arn:aws:iam::*:role/aws-reserved/sso.amazonaws.com/*platform*",
            "arn:aws:iam::*:role/*AWSControlTower*",
            "arn:aws:iam::master_account_id:role/aws-service-role/stacksets.cloudformation.amazonaws.com/AWSServiceRoleForCloudFormationStackSetsOrgAdmin*",
            "arn:aws:iam::*:role/stacksets-exec*",
            "arn:aws:iam::*:role/aws-controltower*"
          ]
        }
      }
    }
  ]
}