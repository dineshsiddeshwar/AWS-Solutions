{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "Statement1",
      "Effect": "Deny",
      "Action": [
        "ec2:RunInstances"
      ],
      "Resource": [
        "arn:aws:ec2:*::image/*"
      ],
      "Condition": {
        "StringNotEquals": {
          "ec2:ResourceTag/platform_image_whitelist": "yes",
          "aws:PrincipalAccount": [
            "905418094632"
          ]
        },
        "ForAllValues:StringEquals": {
          "aws:TagKeys": [
            "*"
          ]
        },
        "ArnNotLike": {
          "aws:PrincipalARN": [
            "arn:aws:iam::*:role/veeam-compute-VeeamInstanceBackupRestoreAccessRole*"
          ]
        }
      }
    },
    {
      "Action": [
        "config:Put*",
        "config:UntagResource"
      ],
      "Effect": "Deny",
      "Resource": "*",
      "Condition": {
        "ArnNotLike": {
          "aws:PrincipalARN": [
            "arn:aws:iam::*:role/platform*",
            "arn:aws:iam::*:role/aws-reserved/sso.amazonaws.com/*platform*",
            "arn:aws:iam::*:role/*AWSControlTower*",
            "arn:aws:iam::master_account_id:role/aws-service-role/stacksets.cloudformation.amazonaws.com/AWSServiceRoleForCloudFormationStackSetsOrgAdmin*",
            "arn:aws:iam::*:role/stacksets-exec*",
            "arn:aws:sts::*:assumed-role/aws-controltower*",
            "arn:aws:iam::*:role/aws-controltower-ConfigRecorderRole"
          ]
        },
        "ForAllValues:StringEqualsIgnoreCase": {
          "aws:TagKeys": [
            "platform_donotdelete"
          ]
        }
      }
    },
    {
      "Action": [
        "config:Delete*",
        "grafana:AssociateLicense",
        "grafana:DisassociateLicense"
      ],
      "Effect": "Deny",
      "Resource": "*",
      "Condition": {
        "ArnNotLike": {
          "aws:PrincipalARN": [
            "arn:aws:iam::*:role/platform*",
            "arn:aws:iam::*:role/aws-reserved/sso.amazonaws.com/*platform*",
            "arn:aws:iam::*:role/*AWSControlTower*",
            "arn:aws:iam::master_account_id:role/aws-service-role/stacksets.cloudformation.amazonaws.com/AWSServiceRoleForCloudFormationStackSetsOrgAdmin*",
            "arn:aws:iam::*:role/stacksets-exec*",
            "arn:aws:sts::*:assumed-role/aws-controltower*",
            "arn:aws:iam::*:role/aws-controltower-ConfigRecorderRole"
          ]
        }
      }
    },
    {
      "Action": [
        "logs:*",
        "events:*"
      ],
      "Effect": "Deny",
      "Resource": [
        "arn:aws:logs:*:*:log-group:platform*:*",
        "arn:aws:events:*:*:rule/platform*"
      ],
      "Condition": {
        "ArnNotLike": {
          "aws:PrincipalARN": [
            "arn:aws:iam::*:role/platform*",
            "arn:aws:iam::*:role/*Wiz*",
            "arn:aws:iam::*:role/aws-reserved/sso.amazonaws.com/*platform*",
            "arn:aws:iam::*:role/*AWSControlTower*",
            "arn:aws:iam::master_account_id:role/aws-service-role/stacksets.cloudformation.amazonaws.com/AWSServiceRoleForCloudFormationStackSetsOrgAdmin*",
            "arn:aws:iam::*:role/stacksets-exec*",
            "arn:aws:sts::*:assumed-role/aws-controltower*",
            "arn:aws:iam::*:role/aws-controltower-ConfigRecorderRole"
          ]
        }
      }
    },
    {
      "NotAction": [
        "lambda:GetAccountSettings",
        "lambda:GetFunctionConfiguration",
        "lambda:GetFunctionEventInvokeConfig",
        "lambda:GetLayerVersionPolicy",
        "lambda:GetPolicy",
        "lambda:List*"
      ],
      "Effect": "Deny",
      "Resource": "arn:aws:lambda:*:*:function:platform*",
      "Condition": {
        "ArnNotLike": {
          "aws:PrincipalARN": [
            "arn:aws:iam::*:role/platform*",
            "arn:aws:iam::*:role/*Wiz*",
            "arn:aws:iam::*:role/aws-reserved/sso.amazonaws.com/*platform*",
            "arn:aws:iam::*:role/*AWSControlTower*",
            "arn:aws:iam::master_account_id:role/aws-service-role/stacksets.cloudformation.amazonaws.com/AWSServiceRoleForCloudFormationStackSetsOrgAdmin*",
            "arn:aws:iam::*:role/stacksets-exec*",
            "arn:aws:sts::*:assumed-role/aws-controltower*",
            "arn:aws:iam::*:role/aws-controltower-ConfigRecorderRole"
          ]
        }
      }
    }
  ]
}