# Imports common-functions
import "tfplan-functions" as tfplan

# Get all Neptune Clusters
neptune_cluster = tfplan.find_resources("aws_neptune_cluster")

# Return all the Neptune Clusters in which IAM database authentication is not enabled
violating_resources = tfplan.filter_attribute_is_not_value(neptune_cluster, "iam_database_authentication_enabled", true, true)

# Main rule
main = rule {
    length(violating_resources["messages"]) is 0
}