{
  "statement": [
    {
      "actions": [
        "airflow:PublishMetrics"
      ],
      "effect": "Allow",
      "resources": [
        "${mwaa_environment_arn}"
      ],
      "sid": ""
    },
    {
      "actions": [
        "s3:ListAllMyBuckets"
      ],
      "effect": "Allow",
      "resources": [
        "${bucket_arn}",
        "${bucket_arn}/*"
      ],
      "sid": ""
    },
    {
      "actions": [
        "s3:GetObject*",
        "s3:GetBucket*",
        "s3:GetBucketPublicAccessBlock",
        "s3:List*"
      ],
      "effect": "Allow",
      "resources": [
        "${bucket_arn}",
        "${bucket_arn}/*"
      ],
      "sid": ""
    },
    {
      "actions": [
        "logs:DescribeLogGroups"
      ],
      "effect": "Allow",
      "resources": [
        "*"
      ],
      "sid": ""
    },
    {
      "actions": [
        "logs:CreateLogStream",
        "logs:CreateLogGroup",
        "logs:PutLogEvents",
        "logs:GetLogEvents",
        "logs:GetLogRecord",
        "logs:GetLogGroupFields",
        "logs:GetQueryResults",
        "logs:DescribeLogGroups"
      ],
      "effect": "Allow",
      "resources": [
        "${mwaa_cloudtrail_arn}"
      ],
      "sid": ""
    },
    {
      "actions": [
        "cloudwatch:PutMetricData"
      ],
      "effect": "Allow",
      "resources": [
        "*"
      ],
      "sid": ""
    },
    {
      "actions": [
        "sqs:ChangeMessageVisibility",
        "sqs:DeleteMessage",
        "sqs:GetQueueAttributes",
        "sqs:GetQueueUrl",
        "sqs:ReceiveMessage",
        "sqs:SendMessage"
      ],
      "effect": "Allow",
      "resources": [
        "arn:aws:sqs:${aws_region}:*:airflow-celery-*"
      ],
      "sid": ""
    },
    {
      "actions": [
        "kms:Decrypt",
        "kms:DescribeKey",
        "kms:GenerateDataKey*",
        "kms:Encrypt"
      ],
      "condition": [
        {
          "test": "StringLike",
          "values": [
            "sqs.${aws_region}.amazonaws.com"
          ],
          "variable": "kms:ViaService"
        }
      ],
      "effect": "Allow",
      "not_resources": [
        "arn:aws:kms:*:${account_id}:key/*"
      ],
      "sid": ""
    }
  ]
}
