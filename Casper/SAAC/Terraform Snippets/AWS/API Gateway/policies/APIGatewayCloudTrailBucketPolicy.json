{
   "Version": "2012-10-17",
   "Statement": [
      {
         "Sid": "splunk_access",
         "Effect": "Allow",
         "Principal": {
            "AWS": "arn:aws:iam::${local.account_id}:root"
         },
         "Action": [
            "s3:Get*",
            "s3:List*"
         ],
         "Resource": [
            "arn:aws:s3:::${var.api_gateway_bucket}/*"
         ]
      },
      {
         "Sid": "all_accounts_in_organization_can_put_object_access",
         "Effect": "Allow",
         "Principal": "*",
         "Action": [
            "s3:Put*"
         ],
         "Condition": {
            "StringEquals": {
               "aws:PrincipalOrgID": [
                  "${local.account_id}"
               ],
               "s3:x-amz-acl": [
                  "bucket-owner-full-control"
               ]
            }
         },
         "Resource": [
            "arn:aws:s3:::${var.api_gateway_bucket}/*"
         ]
      },
      {
         "Effect": "Allow",
         "Principal": {
            "AWS": "arn:aws:iam::${local.account_id}:${data.aws_region.current.name}:root"
         },
         "Action": "s3:PutObject",
         "Resource": "arn:aws:s3:::${var.api_gateway_bucket}/*"
      },
      {
         "Sid": "AWSConfigBucketPermissionsCheck",
         "Effect": "Allow",
         "Principal": {
            "Service": [
               "config.amazonaws.com"
            ]
         },
         "Action": "s3:GetBucketAcl",
         "Resource": "arn:aws:s3:::${var.api_gateway_bucket}"
      },
      {
         "Sid": " AWSConfigBucketDelivery",
         "Effect": "Allow",
         "Principal": {
            "Service": [
               "config.amazonaws.com"
            ]
         },
         "Action": "s3:PutObject",
         "Resource": "arn:aws:s3:::${var.api_gateway_bucket}/${local.account_id}/s3-access-logs/${lookup(var.aws_region_acronym, var.aws_region)}/*",
         "Condition": {
            "StringEquals": {
               "s3:x-amz-acl": "bucket-owner-full-control"
            }
         }
      }
   ]
}
