<!-- omit in toc -->
# AWS X-Ray - Security Baseline Requirement
<!-- omit in toc -->
## Baseline security configuration requirement for AWS services ###
---


Summary of changes: 
1. Added new controls
2. Updated the security control mappings

**Generated By: EY Security Team**

**Service Type: Developer Tool**

**Deployment Phase: Service Discovery** 

**Last Update: 05/25/2022**

## Table of Contents  <!-- omit in toc -->
<!-- TOC -->
- [Overview](#overview)
  - [Use Case Examples:](#use-case-examples)
- [Cloud Security Requirements](#cloud-security-requirements)
  - [1. Ensure AWS X-Ray utilizes VPC endpoints to prevent public access](#1-ensure-aws-x-ray-utilizes-vpc-endpoints-to-prevent-public-access)
  - [2. Ensure AWS X-Ray users and roles are following least privilege model](#2-ensure-aws-x-ray-users-and-roles-are-following-least-privilege-model)
  - [3. Ensure data within AWS X-Ray is encrypted at rest using organization managed key(CMK)](#3-ensure-data-within-aws-x-ray-is-encrypted-at-rest-using-organization-managed-keycmk)
  - [4. Ensure TLS 1.2 or later is supported by clients while communicating to AWS X-Ray](#4-ensure-tls-12-or-later-is-supported-by-clients-while-communicating-to-aws-x-ray)
  - [5. Ensure X-Ray daemon is installed in organization approved systems only](#5-ensure-x-ray-daemon-is-installed-in-organization-approved-systems-only)
  - [6. Ensure to enable Cloudtrail for AWS X-Ray](#6-ensure-to-enable-cloudtrail-for-aws-x-ray)
  - [7. Ensure to monitor AWS X-Ray using Cloudwatch](#7-ensure-to-monitor-aws-x-ray-using-cloudwatch)
  - [8. Ensure AWS X-Ray uses standard organizational resource tagging method](#8-ensure-aws-x-ray-uses-standard-organizational-resource-tagging-method)
- [Endnotes](#endnotes)
  - [Resources](#resources)
  - [Glossary](#glossary)
<!-- /TOC -->

##  Overview
AWS X-Ray helps developers analyze and debug production, distributed applications, such as those built using a micro services architecture. With X-Ray, enterprise can understand how application and its underlying services are performing to identify and troubleshoot the root cause of performance issues and errors. X-Ray provides an end-to-end view of requests as they travel through  application, and shows a map of application’s underlying components. X-Ray can be used to analyze both applications in development and in production, from simple three-tier applications to complex micro services applications consisting of thousands of services.

![archi](https://d1.awsstatic.com/Products/product-name/Images/product-page-diagram_AWS-X-Ray_how-it-works%402x.0d5b08dc2f788d3003a05ddb11e383ba54f41fc4.png)

| Control Number | Cloud Baseline Security Requirements                                                                                |
| -------------- | --------------------------------------------------------------------------------------------------------------------|
| 1	           | Ensure AWS X-Ray utilizes VPC endpoints to prevent public access                                                    |
| 2	           | Ensure AWS X-Ray users and roles are following least privilege model                                                |
| 3	           | Ensure data within AWS X-Ray is encrypted at rest using organization managed key(CMK)                               |
| 4	           | Ensure TLS 1.2 or later is supported by clients while communicating to AWS X-Ray                                    |
| 5	           | Ensure X-Ray daemon is installed in organization approved systems only                                              |
| 6	           | Ensure to enable Cloudtrail for AWS X-Ray                                                                           |
| 7	           | Ensure to monitor AWS X-Ray using Cloudwatch                                                                        |

### Use Case Examples:
- Discover application issues
- Improve application performance
- Review request behavior

## Cloud Security Requirements ##

### 1. Ensure AWS X-Ray utilizes VPC endpoints to prevent public access

**Security control mapping:** <br>

| Control Number | Control Statement | Security Domain | Default | Associated Runbook | CVSS Severity  |
| ------------------ | ------------| --------------- | ------- | ------------------ | -------------- |
| CS0012300  | Cloud products and services must be deployed on private subnets and public access must be disabled for these services| Network Security | Not Enabled | None | [Medium (6.5)](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:A/AC:H/PR:H/UI:R/S:C/C:H/I:L/A:L) |


**Why?** <br>

As per security best practice it is suggested to establish a private connection between VPC and AWS X-Ray by creating an interface VPC endpoint. Interface endpoints are powered by AWS PrivateLink, a technology that enables to privately access AWS X-Ray APIs without an internet gateway, NAT device, VPN connection, or AWS Direct Connect connection. Instances in  VPC don't need public IP addresses to communicate with AWS X-Ray APIs. Traffic between VPC and AWS X-Ray does not leave the Amazon network.

**How?** <br>

https://docs.aws.amazon.com/xray/latest/devguide/xray-security-vpc-endpoint.html

<br><br>

### 2. Ensure AWS X-Ray users and roles are following least privilege model

**Security Control Mapping :**  <br>
| Control Number | Control Statement | Security Domain | Default | Associated Runbook | CVSS Severity  |
| -------------- | ----------------- | --------------- | ------- | ------------------ | -------------- |
| CS0012298 | Access to change cloud identity access and service control policies is restricted to authorized cloud administrative personnel |  Identity & Access Management | Not enabled |None | [Medium (6.8)](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:H/PR:H/UI:R/S:C/C:L/I:L/A:H) |

**Why?** <br>

AWS Identity and Access Management (IAM) to grant X-Ray permissions to users and compute resources in aws account. IAM controls access to the X-Ray service at the API level to enforce permissions uniformly, regardless of which client (console, AWS SDK, AWS CLI) users employ. By default, IAM users and roles don't have permission to create or modify X-Ray resources. They also can't perform tasks using the AWS Management Console, AWS CLI, or AWS API. An IAM administrator must create IAM policies that grant users and roles permission to perform specific API operations on the specified resources they need. The administrator must then attach those policies to the IAM users or groups that require those permissions.

**Following are the suggested roles for AWS X-Ray** <br>
| Function | Description | Role | 
| -------------- | ----------------- | --------------- | 
| Network Admin | Responsible for configuring private endpoint for AWS X-Ray | Networkadmin |
| Security Engineer | Responsible for monitoring and auditing the logs| MonitoringPlatformadmin |
| IAM Admin | Responsible for granting identity based read only access | Custom resource role developed by IAM admin team |
| Developer | Responsible to debug applications | Custom resource role developed by IAM admin team |


**How?** <br>

https://docs.aws.amazon.com/xray/latest/devguide/security_iam_service-with-iam.html

<br><br>

### 3. Ensure data within AWS X-Ray is encrypted at rest using organization managed key(CMK)

**Security Control Mapping :** <br>
| Control Number | Control Statement | Security Domain | Default | Associated Runbook | CVSS Severity  |
| -------------- | ----------------- | --------------- | ------- | ------------------ | -------------- |
| CS0012168 |Strong encryption key management controls are in place for cloud provider services to protect data at rest | Data Protection | Enabled | None | [Medium (5.3)](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:A/AC:H/PR:H/UI:N/S:U/C:H/I:L/A:L) |

**Why?** <br>

AWS X-ray encrypts traces and related data at rest. This traces include detailed information about the request and response, calls that application makes to downstream AWS resources, microservices, databases, and web APIs.As per organization stringent security policy it is advised to ensure that AWS X-Ray trace data is encrypted with organization managed Customer Master Keys (CMKs) instead of AWS managed-keys (i.e. default keys used by Amazon X-Ray service when there are no customer master keys configured for traces) in order to have more control over trace data encryption/decryption process and meet compliance and/or internal requirements.

**How?** <br>

https://docs.aws.amazon.com/xray/latest/devguide/xray-console-encryption.html

<br><br> 

### 4. Ensure TLS 1.2 or later is supported by clients while communicating to AWS X-Ray

**Security Control Mapping :**  <br>
| Control Number | Control Statement | Security Domain | Default | Associated Runbook | CVSS Severity  |
| -------------- | ----------------- | --------------- | ------- | ------------------ | -------------- |
| CS0012261 | Cloud based data in transit must be encrypted with enterprise approved algorithms. | Data Protection | Not enabled | None | [Medium (5.3)](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:A/AC:H/PR:H/UI:N/S:U/C:H/I:L/A:L) |

**Why?** <br>

    [Place Holder]

**How?** <br>

https://docs.aws.amazon.com/xray/latest/devguide/infrastructure-security.html

<br><br>
 
### 5. Ensure X-Ray daemon is installed in organization approved systems only

**Security control mapping:** <br>
| Control Number | Control Statement | Security Domain | Default | Associated Runbook |CVSS Severity|
| ------------------ | ------------| --------------- | ------- | ------------------ |---|
| CS0012133 |[Place Holder] | Configuration Management | Not Enabled | None |[Medium(4.0)](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:L/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:L)|

**Why?** <br>

The AWS X-Ray daemon is a software application that listens for traffic on UDP port 2000, gathers raw segment data, and relays it to the AWS X-Ray API. The daemon works in conjunction with the AWS X-Ray SDKs and must be running so that data sent by the SDKs can reach the X-Ray service. As per security best practice it is suggested to install X-Ray in organization approved system only in order to avoid security breach.

**How?** <br>

https://docs.aws.amazon.com/xray/latest/devguide/xray-daemon.html

<br><br>  
 
### 6. Ensure to enable Cloudtrail for AWS X-Ray

**Security control mapping:** <br>
| Control Number | Control Statement | Security Domain | Default | Associated Runbook |CVSS Severity|
| ------------------ | ------------| --------------- | ------- | ------------------ |---|
| CS0012233| Information system must create a log and record activities occurring on or originating from the information system.Logs must be made accessible to the enterprise SIEM solution  | Security Information and event management | Not Enabled | None|[Low(2.5)](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:L/AC:H/PR:H/UI:N/S:C/C:N/I:N/A:L)|

**Why?** <br>

AWS X-Ray integrates with AWS CloudTrail to record API actions made by a user, a role, or an AWS service in X-Ray. CloudTrail is used to monitor X-Ray API requests in real time and store logs in Amazon S3, Amazon CloudWatch Logs, and Amazon CloudWatch Events

**How?** <br>

https://docs.aws.amazon.com/xray/latest/devguide/xray-api-cloudtrail.html

<br><br> 

### 7. Ensure to monitor AWS X-Ray using Cloudwatch

**Security control mapping:** <br>
| Control Number | Control Statement | Security Domain | Default | Associated Runbook |CVSS Severity|
| ------------------ | ------------| --------------- | ------- | ------------------ |---|
| CS0012233| Information system must create a log and record activities occurring on or originating from the information system.Logs must be made accessible to the enterprise SIEM solution  | Security Information and event management | Not Enabled | None|[Low(3.9)](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:L/AC:H/PR:H/UI:N/S:U/C:L/I:L/A:L)|

**Why?** <br>
    
AWS X-Ray is integrated with AWS Cloudwatch, a service which is a metrics repository for AWS services that allow security teams to retrieve statistics based on the metrics and dimensions published by AWS X-Ray. Use the X-Ray SDK for Java to publish unsampled Amazon CloudWatch metrics from your collected X-Ray segments. These metrics are derived from the segment’s start and end time, and the error, fault and throttled status flags. Use these trace metrics to expose retries and dependency issues within subsegments.

**How?** <br>

https://docs.aws.amazon.com/xray/latest/devguide/xray-services-cloudwatch.html

<br><br> 

### 8. Ensure AWS X-Ray uses standard organizational resource tagging method

**Security control mapping:** <br>
| Control Number | Control Statement | Security Domain | Default | Associated Runbook |CVSS Severity|
| ------------------ | ------------| --------------- | ------- | ------------------ |---|
|CS0012128| Technology hardware and software must be registered and accurately recorded within the enterprise technology repository and/or asset management systems | Asset Management | Not Enabled | Organizational Runbook |[Low(1.6)](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:P/AC:H/PR:H/UI:N/S:U/C:N/I:N/A:L)|


**What, Why & How?** <br>

Identification of your IT assets is a crucial aspect of governance and security. You need to have visibility of all Cognito resources to assess their security posture and take action on potential areas of weakness.

Tagging resources in the cloud is an easy way for teams to provide information related to who owns the resource, what the resource is used for, as well as other important information related to the deployment lifecycle of the resource. Organization has mandated that all cloud resources are to be tagged with for cross-team use.
<br><br> 

## Endnotes ##

### Resources 
1. https://aws.amazon.com/xray/
2. https://docs.aws.amazon.com/xray/latest/devguide/security.html

### Glossary 

**Data** - Digital pieces of information stored or transmitted for use with an information system from which understandable information is
derived. Items considered to be data are: Source code, meta-data, build artifacts, information input and output.

**Information System** - An organized assembly of resources and procedures for the collection, processing, maintenance, use, sharing,
dissemination, or disposition of information. All systems, platforms, compute instances including and not limited to physical and virtual
client endpoints, physical and virtual servers, software containers, databases, Internet of Things (IoT) devices, network devices,
applications (internal and external), Serverless computing instances (i.e. AWS Lambda), vendor provided appliances, and third-party
platforms, connected to the Capital Group network or used by Capital Group users or customers.

**Log** - a record of the events occurring within information systems and networks. Logs are composed of log entries; each entry contains
information related to a specific event that has occurred within a system or network.

**Information** - communication or representation of knowledge such as facts, data, or opinions in any medium or form, including textual,
numerical, graphic, cartographic, narrative, or audiovisual.

**Cloud Computing** - A model for enabling ubiquitous, convenient, on-demand network access to a shared pool of configurable computing
resources (e.g., networks, servers, storage, applications, and services) that can be rapidly provisioned and released with minimal
management effort or service provider interaction.

**Vulnerability**- Weakness in an information system, system security procedures, internal controls, or implementation that could be exploited
or triggered by a threat source. Note: The term weakness is synonymous for deficiency. Weakness may result in security and/or privacy
risks.
