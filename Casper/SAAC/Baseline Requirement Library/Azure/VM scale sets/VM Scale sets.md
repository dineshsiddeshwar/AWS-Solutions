# Azure VM Scale Sets - Security baseline requirement <!-- omit in toc -->
### Baseline security configuration requirement for Azure services  <!-- omit in toc -->
---

**Generated By: TBD** <br>
**Service Type: Compute** <br>
**Deployment Phase:** <br>
**Last updated: 04/21/2022**<br>

## Table of Contents <!-- omit in toc -->

- [Overview](#overview)
  - [Use Case Examples:](#use-case-examples)
- [Cloud Security Control Mapping](#cloud-security-control-mapping)
- [Virtual Machine Scaleset requirement](#virtual-machine-scaleset-requirement)
  - [1. Enable autoscale will monitor abnormal scaling of VMS](#1-enable-autoscale-will-monitor-abnormal-scaling-of-vms)
- [Virtual Machine requirement](#virtual-machine-requirement)
  - [1. Ensure Azure Virtual machines are secured using virtual networks](#1-ensure-azure-virtual-machines-are-secured-using-virtual-networks)
  - [2. Ensure virtual machine network traffic is logged using Network watcher](#2-ensure-virtual-machine-network-traffic-is-logged-using-network-watcher)
  - [3. Ensure VMs are not associated with any public IP address](#3-ensure-vms-are-not-associated-with-any-public-ip-address)
  - [4. Ensure Activity logging is enabled for virtual machines and logs are sent to Splunk](#4-ensure-activity-logging-is-enabled-for-virtual-machines-and-logs-are-sent-to-splunk)
  - [5. Ensure that 'OS and Data' disks are encrypted with Organization Managed Key (CMK)](#5-ensure-that-os-and-data-disks-are-encrypted-with-organization-managed-key-cmk)
  - [6. Ensure all the sensitive information is encrypted during transit](#6-ensure-all-the-sensitive-information-is-encrypted-during-transit)
  - [7. Ensure all the web applications deployed on VM Should not be exposed to Internet](#7-ensure-all-the-web-applications-deployed-on-vm-should-not-be-exposed-to-internet)
  - [8. Ensure least privilege access method is implemented using Role-based access control (RBAC)](#8-ensure-least-privilege-access-method-is-implemented-using-role-based-access-control-rbac)
  - [9. Ensure Azure secrets securely managed using Managed Identities](#9-ensure-azure-secrets-securely-managed-using-managed-identities)
  - [10. Ensure users do not have permission to remove any already installed security software](#10-ensure-users-do-not-have-permission-to-remove-any-already-installed-security-software)
  - [11. Ensure only organization approved VM images are used for deployment](#11-ensure-only-organization-approved-vm-images-are-used-for-deployment)
  - [12. Ensure that Virtual Machine uses standard organizational Resource tagging method](#12-ensure-that-virtual-machine-uses-standard-organizational-resource-tagging-method)
  - [13. Ensure strict Inbound access control is enforced](#13-ensure-strict-inbound-access-control-is-enforced)
  - [14. Ensure Azure VM adheres to organization patch and vulnerability management standards](#14-ensure-azure-vm-adheres-to-organization-patch-and-vulnerability-management-standards)
  - [15. Ensure idle Azure VM instances are identified and stopped or terminated](#15-ensure-idle-azure-vm-instances-are-identified-and-stopped-or-terminated)
  - [16. Ensure Trusted Launch is enabled for Azure Virtual machine](#16-ensure-trusted-launch-is-enabled-for-azure-virtual-machine)



## Overview

Azure virtual machine scale sets are used to create and manage a group of load balanced VMs which can automatically increase or decrease in response to demand or a defined schedule. Scale sets must be used to provide high availability for applications, and to centrally manage, configure, and update a large number of VMs.

![archi](https://docs.microsoft.com/en-us/azure/architecture/browse/thumbs/moodle-azure-netapp-files-architecture-thumbnail.png)

| Control Number | Cloud Baseline Security Requirements                                                       |
| -------------- | ------------------------------------------------------------------------------------------ |
| 1              | Enable autoscale will monitor abnormal scaling of VMS                                      |
| 2              | Ensure Azure Virtual machines are secured using virtual networks                           |
| 3              | Ensure virtual machine network traffic is logged using Network watcher                     |
| 4              | Ensure VMs are not associated with any public IP address                                   |
| 5              | Ensure Activity logging is enabled for virtual machines and logs are sent to Splunk        |
| 6              | Ensure that 'OS and Data' disks are encrypted with Organization Managed Key (CMK)          |
| 7              | Ensure all the sensitive information is encrypted during transit                           |
| 8              | Ensure all the web applications deployed on VM Should not be exposed to Internet           |
| 9              | Ensure least privilege access method is implemented using Role-based access control (RBAC) |
| 10             | Ensure Azure secrets securely managed using Managed Identities                             |
| 11             | Ensure users do not have permission to remove any already installed security software      |
| 12             | Ensure only organization approved VM images are used for deployment                        |
| 13             | Ensure that Virtual Machine uses standard organizational Resource tagging method           |
| 14             | Ensure strict Inbound access control is enforced                                           |
| 15             | Ensure Azure VM adheres to organization patch and vulnerability management standards       |
| 16             | Ensure idle Azure VM instances are identified and stopped or terminated                    |
| 17             | Ensure Trusted Launch is enabled for Azure Virtual machine                                 |

### Use Case Examples:
- Cross-cloud scaling with Traffic Manager
- 3D video rendering
- Scalable and secure WordPress on Azure

## Cloud Security Control Mapping 

---

## Virtual Machine Scaleset requirement

### 1. Enable autoscale will monitor abnormal scaling of VMS

**Security Control Mapping :** 

| Control Number | Control Statement | Security Domain | Default | Associated Runbook |
| -------------- | ----------------- | --------------- | ------- | ------------------ |
| CS0012300 | Cloud products and services must be deployed on private subnets and public access must be disabled for these services | Network Security | Not enabled | Virtual Network Runbook |

**Why?**

Azure Virtual network securely enables the communication of Azure resources with the internet and on-premises resources through organization data center using spoke-hub network model. Security tools in data center will filtering inbound and outbound network traffic based on use case. 

**How?**<br>

Step 1: Select the scale set in the resource group

Step 2:	Choose Scaling from the menu on the left-hand side of the scale set window. Select the button to Custom autoscale

![image info](../docs/images/DeveloperGuidelines/VMScalesets/1a.png)

Step 3:	Select the option to Add a rule.

![image info](../docs/images/DeveloperGuidelines/VMScalesets/1b.png)

Step 4: create a rule for scaling out or scaling in based on scale set traffic

![image info](../docs/images/DeveloperGuidelines/VMScalesets/1c.png)

Step 5: Select Save to see the number and status of VM instances, 

![image info](../docs/images/DeveloperGuidelines/VMScalesets/1d.png)


## Virtual Machine requirement  
### 1. Ensure Azure Virtual machines are secured using virtual networks 

**Security Control Mapping :** 

| Control Number | Control Statement | Security Domain | Default | Associated Runbook |
| -------------- | ----------------- | --------------- | ------- | ------------------ |
| CS0012300 | Cloud products and services must be deployed on private subnets and public access must be disabled for these services | Network Security | Not enabled | Virtual Network Runbook |

**Why?**

Azure Virtual network securely enables the communication of Azure resources with the internet and on-premises resources through organization data center using spoke-hub network model. Security tools in data center will filtering inbound and outbound network traffic based on use case. 

**How?**<br>

Step1: Go to Azure portal and search for virtual machine <br>

Step2: Now click on Virtual Machine after that click on Create a Virtual Machine. <br>

Step3: while creating VM in Networking section new or add an existing Virtual network is created, under Virtual network, also select subnet, configure Network security group using advanced option<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/1a.png)<br>

### 2. Ensure virtual machine network traffic is logged using Network watcher ###

**Security Control Mapping :** 

| Control Number | Control Statement | Security Domain | Default | Associated Runbook |
| -------------- | ----------------- | --------------- | ------- | ------------------ |
|  | | Security Logging| Not enabled | Virtual Network Runbook |

**Why?**

NSG flow logs can be captured to generate flow records for the Azure Virtual Machines. Network Watcher packet capture can also be enabled so that network traffic can be reviewed for unusual and unexpected activity.

**How?**<br>

Step 1: On Network watcher service, Select NSG Flow logs tab. Create a flow log and link it to the storage account for which traffic is logged .<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/5c.png)<br>

Step 2: After linking the storage account, please review and create.<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/5d.png)<br>

### 3. Ensure VMs are not associated with any public IP address ###

**Security Control Mapping :** 

| Control Number | Control Statement | Security Domain | Default | Associated Runbook |
| -------------- | ----------------- | --------------- | ------- | ------------------ |
| CS0012300 | Cloud products and services must be deployed on private subnets and public access must be disabled for these services | Network Security | Not enabled | Virtual Network Runbook |

**Why?**

The public IP address network service can be used to connect the virtual machine (VM) in the virtual network with the internet. The public IP in virtual Machines are getting exposed and making the devices more vulnerable to security attacks. Since Organization uses on-prem data center to route all the network traffic to azure resource using Spoke-hub network model, NATing will be done at the data center and private IP of the VM are used to route the appropriate network traffic, hence no public IP is required.

**How?**<br>

Step 1: Go to Azure portal and search for virtual machine 

Step2: Create virtual machine and Click on the virtual machine created.

Step 3: open/click on Overview section of VM<br>

Step 4: Navigate to overview option to check if there is any public IP is assigned to VM .There is no public IP because while creating VM, in networking section select “none” in public IP.<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/3b.png)<br>

### 4. Ensure Activity logging is enabled for virtual machines and logs are sent to Splunk ###

**Security Control Mapping :** 

| Control Number | Control Statement | Security Domain | Default | Associated Runbook |
| -------------- | ----------------- | --------------- | ------- | ------------------ |
|  | | Security Logging  | Not enabled | None |

**Why?**

Activity logs can be used to audit the operations and actions performed on virtual machine resources. Activity logs can be used to find an error when troubleshooting or to monitor how a user modified a resource. These logs will be used by security operation team to create notable alert on Splunk to monitor any security event. The Splunk addon for Microsoft must be installed and it should forward the logs from Activity log in Azure to Splunk for long time archival and reporting

**How?**

Step1: Go to Azure portal, create a Virtual Machine.

Step 1: In the side menu bar of the Virtual Machine, Navigate to activity log and click on 'Export Activity Logs'.<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/4a.png)<br>

Step 2: on Diagnostic Settings page click on 'Add diagnostic setting' and select Administrative, Security, Alert, policy, recommendation log type and Select Destination details to be 'Archive to a storage account' <br
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/4b.png)<br>


Step 3: Collect the logs and store in Logs Storage account. Connect splunk app for Microsoft services to the Logs storage account and configure the inputs to extract the logs from Azure storage to Splunk <br>
[Place holder for link]


### 5. Ensure that 'OS and Data' disks are encrypted with Organization Managed Key (CMK) ###

**Security Control Mapping :** 

| Control Number | Control Statement | Security Domain | Default | Associated Runbook |
| -------------- | ----------------- | --------------- | ------- | ------------------ |
|  CS0012168       |Strong encryption key management controls are in place for cloud provider services to protect data at rest | Data Protection  | Not enabled | None |

**Why?**

Virtual machine's OS disk (boot volume) and Data disks (non-boot volume) must be encrypted to ensures the entire content is fully unrecoverable without a key. Organization Managed Key provides more granular control to create, rotate and audit Encryption keys.

**How?**<br>

This can be achieved while creating the storage account and after the storage account is created.

**Disk encryption when creating a VM**
Step 1: While creating a VM, in the the Disk section,choose the encryption type. 

Step 2: Disk encryption set must be selected under the encryption type for the customer managed key option <br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/5a.png)<br>

**Disk encryption for an existing VM**
Step 3: Navigate to the existing VM and go into Disk<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/5b.png)<br>

Step 4: Now click on Disk name and select the encryption option on the left side . Disk cannot be encrypted when VM is running. so VM is stopped to encrypt the disk. Choose the Customer Managed Key from the Azure key vault.<br>

Step 5: Create Disk Encryption set and associate the keys to this Disk encryption set <br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/5d.png)<br>

Step 6: After creating Disk Encryption set,permission must be grant for this Disk Encryption set to access key vault and CMK and Disk Encryption set are created in encryption

### 6. Ensure all the sensitive information is encrypted during transit ###

**Security Control Mapping :** 

| Control Number | Control Statement | Security Domain | Default | Associated Runbook |
| -------------- | ----------------- | --------------- | ------- | ------------------ |
|  CS0012261      | Cloud based data in transit must be encrypted with enterprise approved algorithms  | Data Protection  | Not enabled | None |

**Why?**

Data in transit to, from, and between Virtual Machines(VM) that are running can be encrypted based on the nature of the connection such as when connecting to a VM in a RDP or SSH session. Latest Transport Layer Security (TLS) protocol version 1.2 must be used and outdated ssl, TLS 1.0 and 1.2 must be disabled. 

**How?**

Step 1: Go to HomeVirtual Machine

Step 2: Select the created and existing VM <br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/6a.png)<br>

Step 3: Click the policies from the left side menu and click on Assign policy<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/6b.png)<br>

Step 4: In the basics tab click the three dots in policy definition.<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/6c.png)<br>

Step 5: In the search box type in TLS and select Azure Front Door Standard with minimum TLS version as 1.2 <br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/6d.png)<br>

Step 6: Make sure Enable option is selected in Policy enforcement and click on Review+create<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/6e.png)<br>

Step 7: In the Review+create tab click Create. Once the policy is created it will be listed in the policies.<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/6f.png)<br>

### 7. Ensure all the web applications deployed on VM Should not be exposed to Internet ###

**Security Control Mapping :** 

| Control Number | Control Statement | Security Domain | Default | Associated Runbook |
| -------------- | ----------------- | --------------- | ------- | ------------------ |
| CS0012300 | Cloud products and services must be deployed on private subnets and public access must be disabled for these services | Network Security | Not enabled | None |

**Why?**

If any internet accessible application is deployed ensure that NSG should not be configured to allow inbound traffic to from internet on port 80 and 443. All the incoming connection will be routed through organizational data center using Spoke-Hub network model and NSG should be configured to allow web traffic only Hub VNet.

**How?**

Step 1: In the left side bar menu click on Networking. In networking page select the Outbound port rules and click on Add outbound port rule<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/7a.png)<br>

Step 2: In the Add outbound security rule page., fill the following details:
Source : Any, Source port ranges : * , Destination Service : Tag, Destination service tag : Internet, Service : Custom, Destination port : ranges * ,Protocol : Any, Action : Deny, Priority : 100, Name : Internet and click on Add.<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/7b.png)<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/7c.png)<br>

Once The outbound rule is created., the rule will be listed in the outbound port rules.<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/7d.png)<br>

### 8. Ensure least privilege access method is implemented using Role-based access control (RBAC) ###

**Security Control Mapping :** 

| Control Number | Control Statement | Security Domain | Default | Associated Runbook |
| -------------- | ----------------- | --------------- | ------- | ------------------ |
|  CS0012298	    | Access to change cloud identity access and service control policies is restricted to authorized cloud administrative personnel |  IAM | Not enabled | None |

**Why?**

Role-based access control (RBAC) is method of implementing least privilege access by providing access user and service principle based on job function. Azure has several service specific roles the provides granular access. Using Azure entitlements and the usage pattern custom roles can be developed to implement the granular access to individual user and service principal. Organization segregates Network, Storage and platform job functions and each functional team will have custom role specific to their job functions. Example: Storage team will have admin roles ito provision and configure the storage services but will not have access to configure VNet.

**How?**

Step 1: In the left side menu bar, click on Access control (IAM). In the Access control page, select the + Add button and click on Add role assignment.<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/9a.png)<br>

Step 2: In the Role page select the required roles and click next<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/9b.png)<br>

Step 3: In the Members page click the +select members link and add in the members.<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/9c.png)<br>

Step 4: Once roles and members are added select Review+assign button.<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/9d.png)<br>

Once the access control is added successfully., the created role will be listed in the Role assignments tab.<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/9e.png)<br>


### 9. Ensure Azure secrets securely managed using Managed Identities ###

**Security Control Mapping :** 

| Control Number | Control Statement | Security Domain | Default | Associated Runbook |
| -------------- | ----------------- | --------------- | ------- | ------------------ |
|  CS0012298	    | Access to change cloud identity access and service control policies is restricted to authorized cloud administrative personnel |  IAM | Not enabled | None |

**Why?**

Managed identities are special type of service principal without any credential associated with it, There are two types of Managed identity, System Assigned and User assigned manged identity. In system assigned managed identity, Microsoft manages entire life cycle of the identity for VM and a unique identity will be created for each VM instance. For User assigned identity, organization is responsible for identity life cycle. It is recommended to use user identity only when Multiple VM instance  require access to single Azure Resource. Since the secrets are not created for the Managed Identity, the authentication is managed by Azure AD and only the assigned resource can request access token. It is highly recommended to use Managed Identity to enable application deployed inside VM to connect any supported azure resource. 

Note: Current azure resource that can use Managed Identity to authenticate VM/application inside VM https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/managed-identities-status

**How?**

**Enabling system-assigned managed identity during creation of a VM**
 Navigate to the Management and Enable the System Assigned Managed Identity under Identity type<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/10a.png)<br>

**Enabling system-assigned managed identity for an existing VM**
Navigate to the VM -> Settings -> Identity  ->  System Assigned tab and enable the status to On <br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/10b.png)<br>

**Enabling user-assigned managed identity for an existing VM**
Step 1 : Search for managed identity and click Create managed identity
Step 2 :  Select the Resource group and region and provide an identity name<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/10c.png)<br>

Step 3: Navigate to the existing VM -> Settings -> Identity  ->  User Assigned tab click on the add button<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/10d.png)<br>

Step 4: Select the user assigned managed identity and click on Add button <br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/10e.png)<br>


### 10. Ensure users do not have permission to remove any already installed security software ###

**Security Control Mapping :** 

| Control Number | Control Statement | Security Domain | Default | Associated Runbook |
| -------------- | ----------------- | --------------- | ------- | ------------------ |
|  CS0012298	    | Access to change cloud identity access and service control policies is restricted to authorized cloud administrative personnel |  IAM | Not enabled | None |

**Why?**

RBAC is used to create and enforce advanced access by assigning a set of permissions which are based on what level of access specific user categories require to perform their duties. RBAC permissions must be reviewed to ensure that developers do not have the required privileges to uninstall the security and monitoring softwares that are preinstalled by Security team. Removing any software may affect organization ability to monitor, detect and prevent potential security threats.

**How?**

Step 1:   Select the desired Resource and navigate to ‘IAM’ and add role assignment

Step 2:   Select the Built in role 'Virtual Machine User Login' <br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/11b.png)<br>

Step 3:   Select the required user or groups who needs to access the VM <br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/11c.png)<br>

Step 4:   ‘Review & assign’ to complete the process.<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/11d.png)<br>

Step 5:   Once the access control is added successfully., the created role will be listed in the Role assignments tab.<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/11e.png)<br>


### 11. Ensure only organization approved VM images are used for deployment ###

**Security Control Mapping :** 

| Control Number | Control Statement | Security Domain | Default | Associated Runbook |
| -------------- | ----------------- | --------------- | ------- | ------------------ |
|  | | Asset Management  | Not enabled | None |

**Why?**

Organization approved VM images are the Azure Resource Manager templates of the Virtual Machines which are customized and configured to meet the organization and compliance policies. New instances of the VM must be deployed only using these approved images promoting the uniformity and secured design. Patch updates and maintenance will be done to this approved VM Images by Infrastructure team

**How?**

Step 1:   Create a new ‘Azure compute gallery’ and provide a name.<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/12a.png)<br>

Once the deployment is processed, resource is created.<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/12b.png)<br>

Step 2:   Locate the existing VM resource (to utilize this image as standard one) and click ‘create an image’<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/12c.png)<br>

Choose the newly created ‘compute gallery’ name and provide version number & EOL date.<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/12d.png)<br>

The  image will be saved in ‘Azure compute gallery’.<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/12e.png)<br>

Step 3:   Now the standard image can be used for new VM resources (From ‘Shared images’)<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/12f.png)<br>

### 12. Ensure that Virtual Machine uses standard organizational Resource tagging method ###

**Security Control Mapping :** 

| Control Number | Control Statement | Security Domain | Default | Associated Runbook |
| -------------- | ----------------- | --------------- | ------- | ------------------ |
|        | | Asset Management  | Not enabled | Organizational Runbook |

**Why?**

Tagging the virtual machine will help to identify the logical way to own the resource and group them and also helping to assess their security posture and take action on potential areas of weakness.

**How?**

Tagging can be achieved while creating the storage account and after the storage account is created.

**Tagging when creating a VM**
Step 1:   Choose one of the Azure services (Virtual machines)  <br>

Step 2:   While creating a resource, provide the Tag information ‘Name’ and ‘Value’ in Tags option.<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/13c.png)<br>

**Tagging for an existing VM**

Select the desired resource which is already created, provide the Tag information ‘Name’ and ‘Value’ in Tags option.<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/13d.png)<br>

### 13. Ensure strict Inbound access control is enforced ###

**Security Control Mapping :** 

| Control Number | Control Statement | Security Domain | Default | Associated Runbook |
| -------------- | ----------------- | --------------- | ------- | ------------------ |
|   CS0012300   | Cloud products and services must be deployed on private subnets and public access must be disabled for these services | IAM  | Not enabled | None |

**Why?**

Leaving inbound SSH ports and remote Powershell ports open on organization instances greatly increases the risk of lateral movement resulting instance of VM running unauthorized or malicious commands. Even without Internet and public access, it is mandatory to open only network ports that are required for the functioning of application and close any unused ports. This ensures layered security approach is implemented to prevent any lateral movement threats.

**How?** <br>

Step 1:Select the virtual machine for which JIT must be configured.
Step 2:In the left side menu, select Configuration.
Step 3:Under Just-in-time access, select Enable just-in-time.<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/14b.png)<br>

Step 4:This enables just-in-time access for the VM using the default settings

Step 5:To edit the default values or to add more ports to the JIT configuration, Click Open Microsoft Defender for Cloud <br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/14c.png)<br>

Step 6:From the Configured tab, right-click on the VM and select edit.<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/14d.png)<br>

Step 7:	Values can be modified based on the organization requirement<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/14e.png)<br>


### 14. Ensure Azure VM adheres to organization patch and vulnerability management standards ###

**Security Control Mapping :** 

| Control Number | Control Statement | Security Domain | Default | Associated Runbook |
| -------------- | ----------------- | --------------- | ------- | ------------------ |
|   CS0012267   | Security related patches and fixes are applied to systems and applications in accordance with enterprise defined SLA's | Asset Management  | Not enabled | None |

**Why?**

Vulnerabilities are weakness in software that can expose a system to unwanted malicious activity. By applying regular patches and performing regular vulnerability scans based on the enterprise standard SLA will ensure less likely to be exploited

**How?** <br>
Step 1: Select and install the Microsoft antimalware extension in the extension tab of the VM creation page
[Place holder for link]



### 15. Ensure idle Azure VM instances are identified and stopped or terminated ###

**Security Control Mapping :** 

| Control Number | Control Statement | Security Domain | Default | Associated Runbook |
| -------------- | ----------------- | --------------- | ------- | ------------------ |
|     |  | Asset Management  | Not enabled | None |

**Why?**

Identify any Azure VM instances that appear to be idle without actively serving any business purpose, the VM instance should stopped or terminated after specified time, usually Idle outdated VM are attractive target for the attacker to gain initial access and used to pivot and move laterally to gain access to more sensitive resource

**How?**<br>

Step 1:Goto Azure portal https://portal.azure.com/#home

Step 2:Under Azure services, create resource and select create virtual machine.<br>


Step 3:Under Basics, select subscription to manage deployed virtual machine.<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/16b.png)<br>

Step 4:Create resource group and under instance details create virtual machine name.

Step 5:Select the region to deploy our virtual machine.

Step 6:Select image and security type and also authentication type .

Step 7:Under management, select “enable shutdown “option.<br>
![image info](../docs/images/DeveloperGuidelines/VirtualMachines/16c.png)<br>

Step 8:click review+create.
Step 9:After validation passed message, it will ask us to “download private key and create resource”.
Step 10:Deployment will be in progress and after few minutes, deployment get  finished and Virtual machine is created.

### 16. Ensure Trusted Launch is enabled for Azure Virtual machine ###

**Security Control Mapping :** 

| Control Number | Control Statement | Security Domain | Default | Associated Runbook |
| -------------- | ----------------- | --------------- | ------- | ------------------ |
|   CS0012300   | Cloud products and services must be deployed on private subnets and public access must be disabled for these services | IAM  | Not enabled | None |

**Why?**

Trusted launch must be enabled when launching the VM to protect against advanced and persistent attack techniques. Trusted launch is composed of several coordinated infrastructure technologies that can be enabled independently

**How?**<br>

Step 1:Goto Azure portal https://portal.azure.com/#home

Step 2:Under Azure services, create resource and select create virtual machine.

Step 3: Under Basics, select subscription to manage deployed virtual machine.<br>

Step 4:Create resource group and under instance details create virtual machine name.

Step 5:Select the region to deploy the virtual machine.

Step 6: select the security type as “Trusted launch virtual machine” and also select OS which is compatible with trusted launch<br>

![image info](../docs/images/DeveloperGuidelines/VirtualMachines/17b.png)<br>
